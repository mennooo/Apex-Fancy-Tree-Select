var fancyTree=function(){var e={version:"1.0.1",escapeHTML:function(e){if(null===e)return null;if(void 0!==e){if("object"==typeof e)try{e=JSON.stringify(e)}catch(e){}try{return apex.util.escapeHTML(String(e))}catch(o){return(e=String(e)).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")}}},convertJSON2LowerCase:function(o){var r={};try{for(i in o)"[object Object]"===Object.prototype.toString.apply(o[i])?r[i.toLowerCase()]=e.convertJSON2LowerCase(o[i]):"[object Array]"===Object.prototype.toString.apply(o[i])?(r[i.toLowerCase()]=[],r[i.toLowerCase()].push(e.convertJSON2LowerCase(o[i][0]))):r[i.toLowerCase()]=o[i]}catch(e){console.error("error while to lower json"),console.error(e)}return r},tooltip:{show:function(e,o,r){try{if(0==$("#dynToolTip").length){var n=$("<div></div>").attr("id","dynToolTip").css("max-width","400px").css("position","absolute").css("top","0px").css("left","0px").css("z-index","2000").css("background-color","rgba(240, 240, 240, 1)").css("padding","10px").css("display","block").css("top","0").css("overflow-wrap","break-word").css("word-wrap","break-word").css("-ms-hyphens","auto").css("-moz-hyphens","auto").css("-webkit-hyphens","auto").css("hyphens","auto");o&&n.css("background-color",o),r&&n.css("max-width",r),$("body").append(n)}else $("#dynToolTip").css("visibility","visible");$("#dynToolTip").html(e)}catch(e){console.error("Error while try to show tooltip"),console.error(e)}},setPosition:function(e){$("#dynToolTip").position({my:"left+6 top+6",of:e,collision:"flipfit"})},hide:function(){$("#dynToolTip").css("visibility","hidden")},remove:function(){$("#dynToolTip").remove()}},jsonSaveExtend:function(e,o){var r={};if("string"==typeof o)try{o=JSON.parse(o)}catch(e){console.error("Error while try to parse udConfigJSON. Please check your Config JSON. Standard Config will be used."),console.error(e),console.error(o)}else r=o;try{r=$.extend(!0,e,o)}catch(o){console.error("Error while try to merge udConfigJSON into Standard JSON if any attribute is missing. Please check your Config JSON. Standard Config will be used."),console.error(o),r=e,console.error(r)}return r},setItemValue:function(e,o){try{apex.item(e)&&0!=apex.item(e).node?apex.item(e).setValue(o):console.error("Please choose a set item. Because the value ("+o+") can not be set on item ("+e+")")}catch(e){console.error("Error while try to call apex.item"+e)}},noDataMessage:{show:function(e,o){var r=$("<div></div>").css("margin","12px").css("text-align","center").css("padding","64px 0").addClass("nodatafoundmessage"),n=$("<div></div>"),a=$("<span></span>").addClass("fa").addClass("fa-search").addClass("fa-2x").css("height","32px").css("width","32px").css("color","#D0D0D0").css("margin-bottom","16px");n.append(a);var t=$("<span></span>").text(o).css("display","block").css("color","#707070").css("font-size","12px");r.append(n).append(t),$(e).append(r)},hide:function(e){$(e).children(".nodatafoundmessage").remove()}},loader:{start:function(e){try{apex.util.showSpinner($(e))}catch(a){var o=$("<span></span>");o.attr("id","loader"+e),o.addClass("ct-loader fa-stack fa-3x");var r=$("<i></i>");r.addClass("fa fa-circle fa-stack-2x"),r.css("color","rgba(121,121,121,0.6)");var n=$("<i></i>");n.addClass("fa fa-refresh fa-spin fa-inverse fa-stack-1x"),n.css("animation-duration","1.8s"),o.append(r),o.append(n),$(e).append(o)}},stop:function(e){$(e+" > .u-Processing").remove(),$(e+" > .ct-loader").remove()}},copyJSONObject:function(e){try{var o,r={};for(o in e)r[o]=e[o];return r}catch(e){console.error("Error while try to copy object"),console.error(e)}}};return{initTree:function(o,r,n,a,t,s){var i={};(i=e.jsonSaveExtend({checkbox:"fa-square-o",checkboxSelected:"fa-check-square",checkboxUnknown:"fa-square",selectMode:2,autoExpand2Level:2,enableKeyBoard:!0,enableQuicksearch:!0,enableCheckBox:!0,refresh:0},a)).regionID=o,i.ajaxID=r,i.noDataMessage=n,i.items2Submit=t,!1!==s&&(i.escapeHTML=!0);var c=function(o){e.loader.start(i.regionID);try{apex.server.plugin(i.ajaxID,{pageItems:i.items2Submit},{success:o,error:function(o){e.loader.stop(i.regionID),$(i.regionID).empty(),console.error(o.responseText)},dataType:"json"})}catch(e){console.log(e),f(data)}},l=function(e,o){return e-o},d=function(o){try{var r=e.convertJSON2LowerCase(o.row);i.typeSettings&&$.each(r,function(e,o){i.typeSettings.forEach(function(e){e.id==o.type&&(o.icon&&0!=o.icon.length||(o.icon="fa "+e.icon))})});var n=[];for(var a in r)n.push(r[a]);return r=function(e){var o,r,n,a,t,s,i,c,l,d,p,f,h,u,g;for(a=e.id||"id",s=e.parent_id||"parent_id",c=[],i={},o={},t=[],n=d=0,f=(u=e.q).length;d<f;n=++d)i[(r=u[n])[a]]=n,null==o[r[s]]&&(o[r[s]]=[]),o[r[s]].push(e.q[n][a]);for(p=0,h=(g=e.q).length;p<h;p++)null==i[(r=g[p])[s]]&&c.push(r[a]);for(;c.length;)l=c.splice(0,1),t.push(e.q[i[l]]),null!=o[l]&&(c=o[l].concat(c));return t}({q:n}),r=function(e){var o,r,n,a,t,s,i,c,l;for(n=e.id||"id",t=e.parent_id||"parent_id",o=e.children||"children",s={},a=[],i=0,c=(l=e.q).length;i<c;i++)(r=l[i])[o]=[],s[r[n]]=r,null!=s[r[t]]?s[r[t]][o].push(r):a.push(r);return a}({q:r}),o.row&&o.row.length>0?e.noDataMessage.hide(i.regionID):e.noDataMessage.show(i.regionID,i.noDataMessage),r}catch(o){e.loader.stop(i.regionID),$(i.regionID).empty(),console.error("error while try to prepare data for tree."),console.error(o)}},p=function(o){var r=d(o);$(i.regionID).fancytree("getTree").reload(r),e.loader.stop(i.regionID)},f=function(o){var r=d(o);$(i.regionID).fancytree({extensions:["glyph"],clones:{highlightClones:!0},activeVisible:!0,escapeTitles:i.escapeHTML,checkbox:i.enableCheckBox,selectMode:i.selectMode,debugLevel:0,keyboard:i.enableKeyBoard,quicksearch:i.enableQuicksearch,glyph:{preset:"awesome4",map:{_addClass:"fa",checkbox:i.checkbox,checkboxSelected:i.checkboxSelected,checkboxUnknown:i.checkboxUnknown,dragHelper:"fa-arrow-right",dropMarker:"fa-long-arrow-right",error:"fa-warning",expanderClosed:"fa-caret-right",expanderLazy:"fa-angle-right",expanderOpen:"fa-caret-down",loading:"fa-spinner fa-pulse",nodata:"fa-meh-o",noExpander:"",radio:"fa-circle-thin",radioSelected:"fa-circle",doc:"fa-file-o",docOpen:"fa-file-o",folder:"fa-folder-o",folderOpen:"fa-folder-open-o"}},source:r,select:function(o,r){if(""!=r.node.extraClasses&&($(r.node.li).find(".fancytree-node").hasClass("fancytree-selected")?$("."+r.node.extraClasses).addClass("fancytree-selected"):$("."+r.node.extraClasses).removeClass("fancytree-selected")),i.typeSettings){var n=[];i.typeSettings.forEach(function(o){n.push(e.copyJSONObject(o))}),$.each($(i.regionID).fancytree("getTree").getSelectedNodes(),function(e,o){n.forEach(function(e,r){e.id?o.type?o.type==e.id&&(void 0===n[r].data&&(n[r].data=[]),-1===n[r].data.indexOf(o.data.value)&&o.data.value&&n[r].data.push(o.data.value)):console.error("type in not set in data"):console.error("id is not defined in config json in types. Please check help for config json.")})}),n.forEach(function(o){o.storeItem?o.data&&o.data.length>0?(o.data.sort(l),e.setItemValue(o.storeItem,o.data.join(":"))):e.setItemValue(o.storeItem,null):console.error("storeItem is not defined in config json in types. Please check help for config json.")})}else console.error("types is not defined in config json. Please check help for config json.")}}),i.autoExpand2Level>0&&$(i.regionID).fancytree("getRootNode").visit(function(e){e.getLevel()<i.autoExpand2Level&&e.setExpanded(!0)}),e.loader.stop(i.regionID)};c(f),$("#"+o.substring(4)).bind("apexrefresh",function(){0==$(i.regionID).children("span").length&&c(p)}),i.refresh>0&&setInterval(function(){0==$(i.regionID).children("span").length&&c(p)},1e3*i.refresh)}}}();